"use strict";Object.defineProperty(exports,"__esModule",{value:true});const valuePattern=/---!\{.*\}!---/gi;const eventPattern=/^\(.*\)$/gi;const propPattern=/^\[.*\]$/;const sanitizePattern=/^this\./;const startSeparator=/---!\{/gi;const endSeparator=/\}!---/gi;class ContentNode{constructor(t,e){this.node=t;this.index=e}cleanUp(){this.node.textContent=this.node.textContent.replace(startSeparator,"").replace(endSeparator,"")}update(t){if(this.node.nodeValue!==t.node.nodeValue){this.node.nodeValue=t.node.nodeValue}}}class AttributeNode{constructor(t,e,n,a,s){this.node=t;this.index=e;this.boundAttrs=n;this.boundEvents=a;this.context=s;this.addListeners()}addListeners(){this.boundEvents.forEach((t,e)=>{const n=t.split(/\;/);const a=n.filter(t=>t.match(sanitizePattern));const s=a.join("; ");if(t.match(sanitizePattern)){const t=new Function(s);this.node.addEventListener(e,t.bind(this.context))}if(a.length<n.length){console.warn("Inline functions not allowed inside of event bindings. Unsafe functions have been removed from node",this.node)}})}cleanUp(){this.boundAttrs.forEach(t=>t.value=t.value.replace(startSeparator,"").replace(endSeparator,""))}update(t){this.boundAttrs.forEach(e=>{const n=t.boundAttrs.get(e.name);n&&e.value!==n.value?e.value=n.value:null;if(e.name.match(propPattern)){this.updateAttributes(e.name,n)}})}updateAttributes(t,e){const n=t.slice(1,-1);if(e.value){this.node[n]=e.value;this.node.setAttribute(n,e.value)}else{this.node;this.node.removeAttribute(n)}}}class Template{constructor(t,e,n){const a=document.createElement("template");const s=t.replace(startSeparator,"").replace(endSeparator,"");a.innerHTML=s;this.node=document.importNode(a.content,true);this.parts=new Map;this.eventHandlers=[];this.location=e;this.context=n;this._init(t)}paint(){this.location.appendChild(this.node)}update(t){const e=document.createElement("template");e.innerHTML=t;const n=document.importNode(e.content,true);const a=document.createTreeWalker(n,133,null,false);this._parseUpdates(a)}_parseUpdates(t){const e=this._walk(t,new Map);this.parts.forEach((t,n)=>t.update(e.get(n)))}_init(t){const e=document.createElement("template");e.innerHTML=t;const n=document.importNode(e.content,true);const a=document.createTreeWalker(n,133,null,false);this._walk(a,this.parts);this.node=n;this.paint()}_walk(t,e){let n=-1;while(t.nextNode()){n+=1;const{currentNode:a}=t;switch(a.nodeType){case 1:{const{attributes:t}=a;if(t.length){const s=new Map;const o=new Map;for(let e=0;e<t.length;e+=1){const n=t[e];if(n.value.match(valuePattern)||n.name.match(propPattern)){s.set(n.name,n)}if(n.name.match(eventPattern)){const t=n.name.substring(1,n.name.length-1);o.set(t,n.value);this.eventHandlers.push({eventName:t,currentNode:a})}}if(s.size>=1||o.size>=1||this.parts.has(n)){const t=new AttributeNode(a,n,s,o,this.context);e.set(n,t);t.cleanUp()}}break}case 3:{if(a.textContent&&a.textContent.match(valuePattern)||this.parts.has(n)){const t=new ContentNode(a,n);e.set(n,t);t.cleanUp()}break}}}return e}}const templateCache=new Map;function html(t){return function(e,...n){const a=e.map((t,e)=>`${t?t:""}${n[e]?"---!{"+n[e]+"}!---":""}`).join("");const s=btoa(e.join(""));let o=templateCache.get(s);if(o){o.update(a)}else{o=new Template(a,t,this);templateCache.set(s,o)}}}function templit(t,e){function n(...n){const a=Reflect.apply(html,e,[t]);return Reflect.apply(a,e,n)}return n.bind(e)}exports.templit=templit;