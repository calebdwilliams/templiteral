"use strict";Object.defineProperty(exports,"__esModule",{value:true});const valuePattern=/---!\{.*\}!---/gi;const eventPattern=/^\(.*\)$/gi;const propPattern=/^\[.*\]$/;const sanitizePattern=/^this\./;const startSeparator=/---!\{/gi;const endSeparator=/\}!---/gi;class ContentNode{constructor(t,e){this.node=t;this.index=e}cleanUp(){this.node.textContent=this.node.textContent.replace(startSeparator,"").replace(endSeparator,"")}update(t){if(this.node.nodeValue!==t.node.nodeValue){this.node.nodeValue=t.node.nodeValue}}}class AttributeNode{constructor(t,e,n,s,a){this.node=t;this.index=e;this.boundAttrs=n;this.boundEvents=s;this.context=a;this.addListeners()}addListeners(){this.boundEvents.forEach((t,e)=>{const n=t.split(/;/);const s=n.filter(t=>t.match(sanitizePattern));const a=s.join("; ");if(t.match(sanitizePattern)){const t=new Function(a).bind(this.context);this.node.addEventListener(e,t);this.node._boundEvents=t}if(s.length<n.length){console.warn("Inline functions not allowed inside of event bindings. Unsafe functions have been removed from node",this.node)}})}cleanUp(){this.boundAttrs.forEach(t=>t.value=t.value.replace(startSeparator,"").replace(endSeparator,""))}update(t){this.boundAttrs.forEach(e=>{const n=t.boundAttrs.get(e.name);n&&e.value!==n.value?e.value=n.value:null;if(e.name.match(propPattern)){this.updateAttributes(e.name,n)}})}updateAttributes(t,e){const n=t.slice(1,-1);if(e.value){this.node[n]=e.value;this.node.setAttribute(n,e.value)}else{this.node.removeAttribute(n)}}}class Template{constructor(t,e,n){const s=document.createElement("template");const a=t.replace(startSeparator,"").replace(endSeparator,"");s.innerHTML=a;this.parts=new Map;this.templiteralParts=new Set;this.eventHandlers=[];this.location=e;this.context=n;this._init(t)}disconnect(){this.eventHandlers.forEach((t,e)=>{const n=this.eventHandlers[e].currentNode;n.removeEventListener(t,n._boundEvents)})}paint(t){this.location.appendChild(t)}update(t){const e=document.createElement("template");e.innerHTML=t;const n=document.importNode(e.content,true);const s=document.createTreeWalker(n,133,null,false);this._parseUpdates(s)}_parseUpdates(t){const e=this._walk(t,new Map,false);this.parts.forEach((t,n)=>t.update(e.get(n)))}_init(t){const e=document.createElement("template");e.innerHTML=t;const n=document.importNode(e.content,true);const s=document.createTreeWalker(n,133,null,false);this._walk(s,this.parts,true);this.paint(n)}_walk(t,e,n){let s=-1;while(t.nextNode()){s+=1;const{currentNode:a}=t;if(!a.__templiteralCompiler){switch(a.nodeType){case 1:{const{attributes:t}=a;if(t.length){const o=new Map;const r=new Map;for(let e=0;e<t.length;e+=1){const s=t[e];if(s.value.match(valuePattern)||s.name.match(propPattern)){o.set(s.name,s)}if(n&&s.name.match(eventPattern)){const t=s.name.substring(1,s.name.length-1);r.set(t,s.value);this.eventHandlers.push({eventName:t,currentNode:a})}}if(o.size>=1||r.size>=1||this.parts.has(s)){const t=new AttributeNode(a,s,o,r,this.context);e.set(s,t);t.cleanUp()}}break}case 3:{if(a.textContent&&a.textContent.match(valuePattern)||this.parts.has(s)){const t=new ContentNode(a,s);e.set(s,t);t.cleanUp()}break}}}else{this.templiteralParts.add(a)}}return e}}const templateCache=new Map;function html(t){return function(e,...n){const s=e.map((t,e)=>`${t?t:""}${n[e]?"---!{"+n[e]+"}!---":""}`).join("");const a=btoa(e.join(""));let o=templateCache.get(a);if(o){o.update(s)}else{o=new Template(s,t,this);templateCache.set(a,o)}t.__templiteralCompiler=o;return o}}function templiteral(t,e=this){function n(...n){const s=Reflect.apply(html,e,[t]);return Reflect.apply(s,e,n)}return n.bind(e)}function registerElements(t){t.forEach(t=>customElements.define(t.tagName,t))}exports.templiteral=templiteral;exports.registerElements=registerElements;