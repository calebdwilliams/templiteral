"use strict";Object.defineProperty(exports,"__esModule",{value:true});const valuePattern=/---!\{.*\}!---/gi;const eventPattern=/^\(.*\)$/gi;const propPattern=/^\[.*\]$/;const sanitizePattern=/^this\./;const startSeparator=/---!\{/gi;const endSeparator=/\}!---/gi;class ContentNode{constructor(e,t){this.node=e;this.index=t}cleanUp(){this.node.textContent=this.node.textContent.replace(startSeparator,"").replace(endSeparator,"")}update(e){if(this.node.nodeValue!==e.node.nodeValue){this.node.nodeValue=e.node.nodeValue}}}class AttributeNode{constructor(e,t,n,s,a){this.node=e;this.index=t;this.boundAttrs=n;this.boundEvents=s;this.context=a;this.addListeners()}addListeners(){this.boundEvents.forEach((e,t)=>{const n=e.split(/;/);const s=n.filter(e=>e.match(sanitizePattern));const a=s.join("; ");if(e.match(sanitizePattern)){const e=new Function(a).bind(this.context);this.node.addEventListener(t,e);this.node._boundEvents=e}if(s.length<n.length){console.warn("Inline functions not allowed inside of event bindings. Unsafe functions have been removed from node",this.node)}})}cleanUp(){this.boundAttrs.forEach(e=>e.value=e.value.replace(startSeparator,"").replace(endSeparator,""))}update(e){this.boundAttrs.forEach(t=>{const n=e.boundAttrs.get(t.name);n&&t.value!==n.value?t.value=n.value:null;if(t.name.match(propPattern)){this.updateAttributes(t.name,n)}})}updateAttributes(e,t){const n=e.slice(1,-1);if(t.value){const e=JSON.parse(decodeURIComponent(t.value));this.node[n]=e;typeof e==="object"?this.node.setAttribute(n,t.value):null}else{this.node.removeAttribute(n)}}}class Template{constructor(e,t,n){const s=document.createElement("template");const a=e.replace(startSeparator,"").replace(endSeparator,"");s.innerHTML=a;this.parts=new Map;this.templiteralParts=new Set;this.eventHandlers=[];this.location=t;this.context=n;this._init(e)}disconnect(){this.eventHandlers.forEach((e,t)=>{const n=this.eventHandlers[t].currentNode;n.removeEventListener(e,n._boundEvents)})}paint(e){this.location.appendChild(e)}update(e){const t=document.createElement("template");t.innerHTML=e;const n=document.importNode(t.content,true);const s=document.createTreeWalker(n,133,null,false);this._parseUpdates(s)}_parseUpdates(e){const t=this._walk(e,new Map,false);this.parts.forEach((e,n)=>e.update(t.get(n)))}_init(e){const t=document.createElement("template");t.innerHTML=e;const n=document.importNode(t.content,true);const s=document.createTreeWalker(n,133,null,false);this._walk(s,this.parts,true);this.paint(n)}_walk(e,t,n){let s=-1;while(e.nextNode()){s+=1;const{currentNode:a}=e;switch(a.nodeType){case 1:{const{attributes:e}=a;if(e.length){const o=new Map;const r=new Map;for(let t=0;t<e.length;t+=1){const s=e[t];if(s.value.match(valuePattern)||s.name.match(propPattern)){o.set(s.name,s)}if(n&&s.name.match(eventPattern)){const e=s.name.substring(1,s.name.length-1);r.set(e,s.value);this.eventHandlers.push({eventName:e,currentNode:a})}}if(o.size>=1||r.size>=1||this.parts.has(s)){const e=new AttributeNode(a,s,o,r,this.context);t.set(s,e);e.cleanUp()}}break}case 3:{if(a.textContent&&a.textContent.match(valuePattern)||this.parts.has(s)){const e=new ContentNode(a,s);t.set(s,e);e.cleanUp()}break}}}return t}}const templateCache=new Map;function parseObject(e){if(typeof e==="object"){return encodeURIComponent(JSON.stringify(e))}return e}function html(e){return function(t,...n){const s=t.map((e,t)=>`${e?e:""}${n[t]?"---!{"+parseObject(n[t])+"}!---":""}`).join("");const a=btoa(t.join(""));let o=templateCache.get(a);if(o){o.update(s)}else{o=new Template(s,e,this);templateCache.set(a,o)}e.__templiteralCompiler=o;return o}}function templiteral(e,t=this){function n(...n){const s=Reflect.apply(html,t,[e]);return Reflect.apply(s,t,n)}return n.bind(t)}function registerElements(e){e.forEach(e=>customElements.define(e.tagName,e))}exports.templiteral=templiteral;exports.registerElements=registerElements;