const valuePattern=/---!{.*?(}!---)/gi;const propPattern=/^\[.*\]$/;const matchPattern=/---!{\d+}!---/gi;const deepEqual=(t,e)=>{if(t===e)return true;if(t&&e&&typeof t=="object"&&typeof e=="object"){const s=Array.isArray(t);const i=Array.isArray(e);let n;let r;let o;if(s&&i){r=t.length;if(r!=e.length)return false;for(n=r;n--!==0;)if(!deepEqual(t[n],e[n]))return false;return true}if(s!=i)return false;const a=t instanceof Date;const h=e instanceof Date;if(a!=h)return false;if(a&&h)return t.getTime()==e.getTime();const l=t instanceof RegExp;const c=e instanceof RegExp;if(l!=c)return false;if(l&&c)return t.toString()==e.toString();const u=Object.keys(t);r=u.length;if(r!==Object.keys(e).length)return false;for(n=r;n--!==0;)if(!Object.hasOwnProperty.call(e,u[n]))return false;for(n=r;n--!==0;){o=u[n];if(!deepEqual(t[o],e[o]))return false}return true}else if(t&&e&&typeof t=="function"&&typeof e=="function"){return true}return t!==t&&e!==e};const protectProperty=(t,e,s)=>Object.defineProperty(t,e,{value:s,enumerable:false,configurable:false,writable:false});const protectGet=(t,e,s)=>Object.defineProperty(t,e,{get:s,configurable:false,enumerable:false});const rendererSymbol=Symbol("Renderer");const repeaterSymbol=Symbol("Repeater");const removeSymbol=Symbol("RemoveTemplate");const valueToInt=t=>+t.replace(/(---!{)|(}!---)/gi,"");const toEventName=t=>t.replace(/(\()|(\))/gi,"");const nullProps=(t,e)=>e.forEach(e=>t[e]=null);class ContentNode{constructor(t,e){this.node=t;this.compiler=e;this.base=t.nodeValue||"";this.indicies=this.base.match(valuePattern).map(valueToInt);this.indicies.forEach(t=>this.compiler.partIndicies.set(t,this))}update(t){this.node.nodeValue=this.base.replace(matchPattern,e=>{const s=t[valueToInt(e)];return s===null?"":t[valueToInt(e)]})}}class AttributeNode{constructor(t,e,s,i,n){this.node=t;this.boundAttrs=e;this.boundEvents=s;this.context=i;this.compiler=n;this.boundAttrs.forEach(t=>{t.base=t.value;t.bases=t.base.match(matchPattern)||[];t.baseIndicies=t.bases.map(valueToInt);t.cleanName=t.name.replace(/\[|\]/g,"");const e=t.base.match(valuePattern)||[];this.indicies=e.map(valueToInt);this.indicies.forEach(t=>this.compiler.partIndicies.set(t,this))});this.eventMap=new Map}addListener(t,e){if(!this.eventMap.get(t)){this.node.addEventListener(t,e.bind(this.context));this.eventMap.set(t,e);!this.context.DEBUG?this.node.removeAttribute(`(${t})`):null}}disconnect(){if(this.eventMap.size){this.eventMap.forEach((t,e,s)=>{this.node.removeEventListener(e,t);s.delete(e)})}}updateProperty(t,e){const s=t.cleanName;!this.context.DEBUG?this.node.removeAttribute(t.name):null;this.node[s]=e;if(e&&(e!=="false"&&e!=="undefined")){this.node.setAttribute(s,e)}else{this.node.removeAttribute(s)}}update(t){this.boundAttrs.forEach(e=>{let s=e.base;for(let i=0;i<e.baseIndicies.length;i+=1){const n=e.baseIndicies[i];const r=t[n]||"";if(typeof r!=="function"){s=s.replace(`---!{${n}}!---`,r)}else{this.addListener(toEventName(e.name),r);this.boundAttrs.delete(e.name)}}e.value=s;if(e.name.match(propPattern)){if(e.baseIndicies.length===1){s=t[e.baseIndicies[0]]}this.updateProperty(e,s)}})}}class DirectiveNode{constructor(t,e,s,i,n){this.node=t;this.values=e;this.context=s;this.compiler=i;this.index=n;this.templateMap=null;this.compiler.partIndicies.set(n,this);this.node[repeaterSymbol]=[];this.repeater=this.node[repeaterSymbol];this.group=Symbol("Group")}init(){this.templates=this.values.map((t,e)=>{const[s,i]=t;const{$$key:n}=i;if(this.templateMap===null){if(typeof n!=="string"&&typeof n!=="number"){this.templateMap=new WeakMap}else{this.templateMap=new Map}}let r;if(this.templateMap.has(n)){r=this.templateMap.get(n);r.update(i)}else{r=new Template(s,i,this.node,this.context,this.group,e);this.templateMap.set(n,r)}this.node[this.group].set(e,r);this.repeater.push(...r.nodes);return r})}update(t){const e=t[this.index];const s=this.values;this.values=e;const i=new Set(this.values.map(([,t])=>t.$$key));const n=new Set(s.map(([,t])=>t.$$key));const r=new Set;i.forEach(t=>{n.has(t)?null:r.add(t)});n.forEach(t=>{const e=this.templateMap.get(t);if(e&&!i.has(t)){e[removeSymbol]();this.templateMap.delete(t)}});this.init()}}class Template{constructor(t,e,s,i,n=null,r=null){this.strings=t;this.values=e;this.oldValues=e.map((t,e)=>`---!{${e}}!---`);this.location=s;this.context=i;this.group=n;this.index=r;this.context.refs=this.context.refs||{};this.parts=[];this.partIndicies=new Map;this.context.$el=s;this.templateSymbol=Symbol("Template");this.nodes=[];this._init()}_append(t){this.nodes=Array.from(t.children).map(t=>{t[this.templateSymbol]=this;return t});if(this.location instanceof Comment){if(this.group){this.location[this.group]=this.location[this.group]||new Map;let e=this.location[this.group];this.location[this.group].set(this.index,this);if(this.index===0){this.location.after(t)}else{let s=this.index-1;while(!e.get(s)){s-=1}e.get(s).nodes[e.get(this.index-1).nodes.length-1].after(t)}}}else{this.location.appendChild(t)}if(!this.context[rendererSymbol]){protectProperty(this,rendererSymbol,this)}}_createBase(){return this.strings.map((t,e)=>{const s=this.values[e];const i=`---!{${e}}!---`;let n="";n+=t?t:"";if(s!==undefined&&!Array.isArray(s)){n+=i}else if(s!==undefined&&Array.isArray(s)){n+=`\x3c!-- ${i} --\x3e`}return n}).join("")}_createNode(t){const e=document.createElement("template");e.innerHTML=t;return document.importNode(e.content,true)}_init(){const t=this._createBase();const e=this._createNode(t);const s=document.createTreeWalker(e,133,null,false);this._walk(s,this.parts,true);this._append(e)}_walk(t,e){while(t.nextNode()){const{currentNode:s}=t;switch(s.nodeType){case 1:{const{attributes:t}=s;if(t.length){const i=new Map;const n=new Map;for(let e=0;e<t.length;e+=1){const n=t[e];if(n.value.match(valuePattern)||n.name.match(propPattern)){i.set(n.name,n)}else if(n.name.match("ref")){this.context.refs[n.value]=s}}if(i.size>=1||n.size>=1){const t=new AttributeNode(s,i,n,this.context,this);e.push(t);t.update(this.values,this.oldValues)}}break}case 3:{if(s.textContent&&s.textContent.match(valuePattern)){const t=new ContentNode(s,this);e.push(t);t.update(this.values,this.oldValues)}break}case 8:{const t=valueToInt(s.nodeValue);const i=this.values[t];const n=this.values[t];const r=new DirectiveNode(s,n,this.context,this,t,i);e.push(r);r.init(this.values[e.length-1]);break}}}}update(t){this.oldValues=this.values;this.values=t;for(let e=0;e<t.length;e+=1){const s=this.partIndicies.get(e);s&&!deepEqual(t[e],this.oldValues[e])&&s.update(t)}}[removeSymbol](){this.nodes.forEach(t=>t.parentNode.removeChild(t));this.parts.filter(t=>t instanceof AttributeNode).forEach(t=>t.disconnect());nullProps(this,["nodes","parts","partIndicies","context","location","group"])}}class StyleSheetRegistry{constructor(){this.adopters=new WeakMap;this.registry=new Map;this.observer=new MutationObserver(t=>{t.forEach(t=>{[...t.removedNodes].forEach(t=>{if(this.adopters.has(t)){this.adopters.delete(t)}else if(this.adopters.has(t.shadowRoot)){this.adopters.delete(t.shadowRoot)}})})});this.observer.observe(document.body,{childList:true});this._error=Symbol("error");this._pending=Symbol("pending");this.pending=new Set}adopt(t,e){const s=this.adopters.get(t)||new Map;if(!s.size){this.adopters.set(t,s)}if(!s.has(e)&&this.get(e)!==this._pending){const i=this.get(e);t.appendChild(i);s.set(e,i);return Promise.resolve(i)}else if(this.get(e)===this._pending){return new Promise((i,n)=>{const r=window.setInterval(()=>{if(this.get(e)){const o=this.get(e);if(o!==this._error&&o!==this._pending){t.appendChild(o);s.set(e,o);i(o);window.clearInterval(r)}else if(o===this._error){n();window.clearInterval(r)}}},200)})}else{return Promise.resolve(s.get(e))}}createSheet(t){const e=document.createElement("style");e.textContent=t;return e}define(t,e){this.registry.set(t,e);return Promise.resolve({name:t})}get(t){if(this.registry.get(t)){const e=this.registry.get(t);if(e===this._pending||e===this._error){return e}return this.createSheet(e)}else{throw new Error(``)}}load(t,e,s){this.registry.set(t,this._pending);return fetch(e,s).then(t=>t.text()).then(e=>{this.define(t,e);return t}).catch(e=>{this.define(t,this._error)})}}const templateCache=new WeakMap;const styleRegistry=new StyleSheetRegistry;function templiteral(t=this,e=this){t.shadowRoot?t=t.shadowRoot:null;return(s,...i)=>{let n=templateCache.get(t);if(n&&s===n.strings){n.update(i)}else if(n){[...n.location.children].forEach(t=>n.location.removeChild(t));n=new Template(s,i,t,e);templateCache.set(t,n)}else{n=new Template(s,i,t,e);templateCache.set(t,n)}return n}}function fragment(t){return(e,...s)=>{protectProperty(s,"$$key",t);return[e,s]}}function condition(t){return(e,...s)=>{protectProperty(s,"$$key",t?"condition":"false");return t?[[e,s]]:[[[],s]]}}class Component extends HTMLElement{static get styles(){return styleRegistry}static get defineStyles(){return this.styles.define.bind(styleRegistry)}static get hasStyles(){return this.styles.registry.has.bind(styleRegistry.registry)}static get loadStyles(){return this.styles.load.bind(styleRegistry)}static get adoptStyles(){return this.styles.adopt.bind(styleRegistry)}static get boundAttributes(){return[]}static get boundProps(){return[]}static get observedAttributes(){return[...this.boundAttributes]}static get booleanAttributes(){return[]}constructor(){super();const t={};const e=new Set;const s=watch(t,(t,e,s)=>{try{if(this.constructor.boundAttributes.includes(e)){if(s.value===false||s.value===null){this.removeAttribute(e)}else{this.setAttribute(e,s.value)}}this.render()}catch(t){console.log(t)}});Object.defineProperty(this,"state",{get(){return s},set(e){Object.keys(e).forEach(s=>{if(typeof e[s]!=="string"||typeof e[s]!=="number"){t[s]=e[s]}else{t[s]=watch(e[s],()=>this.render())}});return true}});this.constructor.boundAttributes.map((t,s,i)=>{Object.defineProperty(this,t,{get(){if(this.constructor.booleanAttributes.includes(t)){return this.hasAttribute(t)}return this.getAttribute(t)},set(s){if(this.constructor.booleanAttributes.includes(t)){if(s||s===""){this.setAttribute(t,true)}else{this.removeAttribute(t)}}else{if(s){this.setAttribute(t,s)}else{this.removeAttribute(t)}}if(this.constructor.boundProps.includes(name)){this[name]=s}if(this.isConnected&&e.size===i.length){this.render()}e.add(t)}})});protectGet(this,"templiteral",()=>templiteral(this.shadowRoot?this.shadowRoot:this,this));protectGet(this,"html",()=>(...t)=>Reflect.apply(this.templiteral,this,t));protectProperty(this,"fragment",fragment);protectProperty(this,"if",condition)}attributeChangedCallback(t,e,s){if(this.constructor.booleanAttributes.includes(t)&&e!==s){s=s===""?true:s;this.state[t]=!!s;if(this.constructor.boundProps.includes(t)){this[t]=!!s}}else if(e!==s){this.state[t]=s;if(this.constructor.boundProps.includes(t)){this[t]=s}}this.emit("ComponentRender",{component:this,time:Date.now()})}connectedCallback(){this.render();if(!this.$$listening){this.addEventListener("ComponentRender",this.render)}if(this.constructor.hasStyles(this.tagName.toLowerCase())){this.constructor.adoptStyles(this.shadowRoot?this.shadowRoot:this,this.tagName.toLowerCase())}this.$$listening=true;this.onInit()}disconnectedCallback(){templateCache.delete(this);this.removeEventListener("ComponentRender",this.render);this.$$listening=false;this[rendererSymbol]&&this[rendererSymbol][removeSymbol]();this.onDestroy()}emit(t,e){this.dispatchEvent(new CustomEvent(t,{bubbles:true,composed:true,detail:e}))}onInit(){}onDestroy(){}render(){}}const watch=(t,e)=>{const s={get(t,e,i){try{const n=Object.getOwnPropertyDescriptor(t,e);const r=Reflect.get(t,e,i);if(n&&!n.writable&&!n.configurable){return r}if(typeof t[e]==="function"&&(t instanceof Date||t instanceof Map||t instanceof WeakMap)){return new Proxy(t[e].bind(t),s)}return new Proxy(t[e],s)}catch(s){if(t instanceof HTMLElement){return t[e]}return Reflect.get(t,e,i)}},set(t,s,i){t[s]=i;e(t,s,{value:i});return true},defineProperty(t,s,i){const n=Reflect.defineProperty(t,s,i);e(t,s,i);return n},deleteProperty(t,s,i){const n=Reflect.deleteProperty(t,s);e(t,s,i);return n}};return new Proxy(t,s)};export{templiteral,fragment,condition,Component,watch};