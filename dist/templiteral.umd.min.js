(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports):typeof define==="function"&&define.amd?define(["exports"],e):e(t.templit={})})(this,function(t){"use strict";const e=/---!{.*?(}!---)/gi;const s=/^\[.*\]$/;const n=/---!{\d+}!---/gi;const i=Symbol("RemoveTemplate");const r=Symbol("Renderer");const o=Symbol("Repeater");const a=t=>+t.replace(/(---!{)|(}!---)/gi,"");const c=t=>t.replace(/(\()|(\))/gi,"");class h{constructor(t,s){this.node=t;this.compiler=s;this.base=t.nodeValue||"";this.indicies=this.base.match(e).map(a);this.indicies.forEach(t=>this.compiler.partIndicies.set(t,this))}update(t){this.node.nodeValue=this.base.replace(n,e=>{const s=t[a(e)];return s===null?"":t[a(e)]})}}class l{constructor(t,s,i,r,o){this.node=t;this.boundAttrs=s;this.boundEvents=i;this.context=r;this.compiler=o;this.boundAttrs.forEach(t=>{t.base=t.value;t.bases=t.base.match(n)||[];t.baseIndicies=t.bases.map(a);t.cleanName=t.name.replace(/\[|\]/g,"");const s=t.base.match(e)||[];this.indicies=s.map(a);this.indicies.forEach(t=>this.compiler.partIndicies.set(t,this))});this.eventMap=new Map}addListener(t,e){if(!this.eventMap.get(t)){this.node.addEventListener(t,e.bind(this.context));this.eventMap.set(t,e);!this.context.DEBUG?this.node.removeAttribute(`(${t})`):null}}disconnect(){if(this.eventMap.size){this.eventMap.forEach((t,e,s)=>{this.node.removeEventListener(e,t);s.delete(e)})}}updateProperty(t,e){const s=t.cleanName;!this.context.DEBUG?this.node.removeAttribute(t.name):null;this.node[s]=e;if(e&&(e!=="false"&&e!=="undefined")){this.node.setAttribute(s,e)}else{this.node[s]=false;this.node.removeAttribute(s)}}update(t){this.boundAttrs.forEach(e=>{let n=e.base;for(let s=0;s<e.baseIndicies.length;s+=1){const i=e.baseIndicies[s];const r=t[i]||"";if(typeof r!=="function"){n=n.replace(`---!{${i}}!---`,r)}else{this.addListener(c(e.name),r);this.boundAttrs.delete(e.name)}}e.value=n;if(e.name.match(s)){if(e.baseIndicies.length===1){n=t[e.baseIndicies[0]]}this.updateProperty(e,n)}})}}const u=(t,e)=>{if(t===e)return true;if(t&&e&&typeof t=="object"&&typeof e=="object"){const s=Array.isArray(t);const n=Array.isArray(e);let i;let r;let o;if(s&&n){r=t.length;if(r!=e.length)return false;for(i=r;i--!==0;)if(!u(t[i],e[i]))return false;return true}if(s!=n)return false;const a=t instanceof Date;const c=e instanceof Date;if(a!=c)return false;if(a&&c)return t.getTime()==e.getTime();const h=t instanceof RegExp;const l=e instanceof RegExp;if(h!=l)return false;if(h&&l)return t.toString()==e.toString();const d=Object.keys(t);r=d.length;if(r!==Object.keys(e).length)return false;for(i=r;i--!==0;)if(!Object.hasOwnProperty.call(e,d[i]))return false;for(i=r;i--!==0;){o=d[i];if(!u(t[o],e[o]))return false}return true}else if(t&&e&&typeof t=="function"&&typeof e=="function"){return true}return t!==t&&e!==e};class d{constructor(t,e,s,n,i){this.node=t;this.values=e;this.context=s;this.compiler=n;this.index=i;this.templateMap=null;this.compiler.partIndicies.set(i,this);this.node[o]=[];this.repeater=this.node[o];this.group=Symbol("Group")}init(){this.templates=this.values.map((t,e)=>{const[s,n]=t;const{$$key:i}=n;if(this.templateMap===null){if(typeof i!=="string"&&typeof i!=="number"){this.templateMap=new WeakMap}else{this.templateMap=new Map}}let r;if(this.templateMap.has(i)){r=this.templateMap.get(i);r.update(n)}else{r=new f(s,n,this.node,this.context,this.group,e);this.templateMap.set(i,r)}this.node[this.group].set(e,r);this.repeater.push(...r.nodes);return r})}update(t){const e=t[this.index];const s=this.values;this.values=e;const n=new Set(this.values.map(([,t])=>t.$$key));const r=new Set(s.map(([,t])=>t.$$key));const o=new Set;n.forEach(t=>{r.has(t)?null:o.add(t)});r.forEach(t=>{const e=this.templateMap.get(t);if(e&&!n.has(t)){e[i]();this.templateMap.delete(t)}});this.init()}}class f{constructor(t,e,s,n,i=null,r=null){this.strings=t;this.values=e;this.oldValues=e.map((t,e)=>`---!{${e}}!---`);this.location=s;this.context=n;this.group=i;this.index=r;this.context.refs=this.context.refs||{};this.parts=[];this.partIndicies=new Map;this.context.$el=s;this.templateSymbol=Symbol("Template");this.nodes=[];this._init()}_append(t){this.nodes=Array.from(t.children).map(t=>{t[this.templateSymbol]=this;return t});if(this.location instanceof Comment){if(this.group){this.location[this.group]=this.location[this.group]||new Map;let e=this.location[this.group];this.location[this.group].set(this.index,this);if(this.index===0){this.location.after(t)}else{let s=this.index-1;while(!e.get(s)){s-=1}e.get(s).nodes[e.get(this.index-1).nodes.length-1].after(t)}}}else{this.location.appendChild(t)}if(!this.context[r]){Object.defineProperty(this,r,{value:this,enumerable:false,configurable:false,writable:false});this.context.onInit&&typeof this.context.onInit==="function"&&this.context.onInit()}}_createBase(){return this.strings.map((t,e)=>{const s=this.values[e];const n=`---!{${e}}!---`;let i="";i+=t?t:"";if(s!==undefined&&!Array.isArray(s)){i+=n}else if(s!==undefined&&Array.isArray(s)){i+=`\x3c!-- ${n} --\x3e`}return i}).join("")}_createNode(t){const e=document.createElement("template");e.innerHTML=t;return document.importNode(e.content,true)}_init(){const t=this._createBase();const e=this._createNode(t);const s=document.createTreeWalker(e,133,null,false);this._walk(s,this.parts,true);this._append(e)}_walk(t,n){while(t.nextNode()){const{currentNode:i}=t;switch(i.nodeType){case 1:{const{attributes:t}=i;if(t.length){const r=new Map;const o=new Map;for(let n=0;n<t.length;n+=1){const o=t[n];if(o.value.match(e)||o.name.match(s)){r.set(o.name,o)}else if(o.name.match("ref")){this.context.refs[o.value]=i}}if(r.size>=1||o.size>=1){const t=new l(i,r,o,this.context,this);n.push(t);t.update(this.values,this.oldValues)}}break}case 3:{if(i.textContent&&i.textContent.match(e)){const t=new h(i,this);n.push(t);t.update(this.values,this.oldValues)}break}case 8:{const t=a(i.nodeValue);const e=this.values[t];const s=this.values[t];const r=new d(i,s,this.context,this,t,e);n.push(r);r.init(this.values[n.length-1]);break}}}}update(t){this.oldValues=this.values;this.values=t;for(let e=0;e<t.length;e+=1){!u(t[e],this.oldValues[e])&&window.requestAnimationFrame(()=>this.partIndicies.get(e).update(t))}}[i](){this.nodes.forEach(t=>t.parentNode.removeChild(t));this.nodes=null;this.parts.filter(t=>t instanceof l).forEach(t=>t.disconnect());this.parts=null;this.partIndicies=null;this.context=null;this.location=null;this.group=null}}class p extends HTMLElement{constructor(){super();this.cached=[]}connectedCallback(){this.style.display="contents"}set condition(t){if(t===false){Array.from(this.children).map(t=>{this.cached.push(t);this.removeChild(t)});this.innerHTML=""}else if(t===true){this.cached.forEach(t=>this.appendChild(t));this.cached=[]}}}if(!customElements.get("t-if")){customElements.define("t-if",p)}const m=new WeakMap;function b(t=this,e=this){t.shadowRoot?t=t.shadowRoot:null;return(s,...n)=>{let i=m.get(t);if(i&&s===i.strings){i.update(n)}else if(i){[...i.location.children].forEach(t=>i.location.removeChild(t));i=new f(s,n,t,e);m.set(t,i)}else{i=new f(s,n,t,e);m.set(t,i)}return i}}function g(t){return(e,...s)=>{Object.defineProperty(s,"$$key",{value:t,enumerable:false,configurable:false,writable:false});return[e,s]}}class y extends HTMLElement{static get boundAttributes(){return[]}static get observedAttributes(){return[...this.boundAttributes]}static get renderer(){return"render"}constructor(t={}){super();const e=this;const s=new Set;const n=v(t,(t,e,s)=>{try{if(this.constructor.boundAttributes.includes(e)){if(s.value===false||s.value===null){this.removeAttribute(e)}else{this.setAttribute(e,s.value)}}this[this.constructor.renderer].bind(this)()}catch(t){console.log(t)}});Object.defineProperty(this,"state",{get(){return n},set(e){Object.keys(e).forEach(s=>{if(typeof e[s]!=="string"||typeof e[s]!=="number"){t[s]=e[s]}else{t[s]=v(e[s],()=>this[this.constructor.renderer]())}});return true}});this.constructor.boundAttributes.map((t,e,n)=>{Object.defineProperty(this,t,{get(){return this.getAttribute(t)||this.hasAttribute(t)},set(e){if(e||e===""){this.setAttribute(t,e)}else{this.removeAttribute(t)}if(this.constructor.renderer&&typeof this[this.constructor.renderer]==="function"&&this.isConnected&&s.size===n.length){this[this.constructor.renderer]()}s.add(t)}})});Object.defineProperty(this,"templiteral",{get(){const t=e.shadowRoot?e.shadowRoot:e;return b(t,e)},configurable:false,enumerable:false});Object.defineProperty(this,"html",{get(){return(...t)=>Reflect.apply(e.templiteral,e,t)},configurable:false,enumerable:false});Object.defineProperty(this,"fragment",{value:g,configurable:false,enumerable:false,writable:false})}attributeChangedCallback(t,e,s){if(e!==s){this.state[t]=s}else if(s===""&&this.hasAttribute(t)){this.state[t]=true}this.emit("ComponentRender",{component:this,time:Date.now()})}get $$renderListener(){return this[this.constructor.renderer]}connectedCallback(){if(this.constructor.renderer&&typeof this[this.constructor.renderer]==="function"){this[this.constructor.renderer]();if(!this.$$listening){this.addEventListener("ComponentRender",this.$$renderListener)}}this.$$listening=true}disconnectedCallback(){m.delete(this);if(this.constructor.renderer&&typeof this[this.constructor.renderer]==="function"){this.removeEventListener("ComponentRender",this.$$renderListener);this.$$listening=false}this[r]&&this[r][i]();if(this.onDestroy&&typeof this.onDestroy==="function"){this.onDestroy()}}emit(t,e){this.dispatchEvent(new CustomEvent(t,{bubbles:true,composed:true,detail:e}))}}const v=(t,e)=>{const s={get(t,e,n){const i=Object.getOwnPropertyDescriptor(t,e);const r=Reflect.get(t,e,n);if(i&&!i.writable&&!i.configurable){return r}try{if(typeof t[e]==="function"&&(t instanceof Date||t instanceof Map||t instanceof WeakMap)){return new Proxy(t[e].bind(t),s)}return new Proxy(t[e],s)}catch(s){return Reflect.get(t,e,n)}},set(t,s,n){t[s]=n;e(t,s,{value:n});return true},defineProperty(t,s,n){const i=Reflect.defineProperty(t,s,n);e(t,s,n);return i},deleteProperty(t,s,n){const i=Reflect.deleteProperty(t,s);e(t,s,n);return i}};return new Proxy(t,s)};const w=(t,e,s)=>{let n;return function i(...r){const o=this;const a=()=>{n=null;!s&&Reflect.apply(t,o,r)};const c=s&&!n;clearTimeout(n);n=setTimeout(a,e);c&&Reflect.apply(t,o,r)}};t.templiteral=b;t.fragment=g;t.Component=y;t.watch=v;t.debounce=w;Object.defineProperty(t,"__esModule",{value:true})});