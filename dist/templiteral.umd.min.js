(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports):typeof define==="function"&&define.amd?define(["exports"],t):t(e.templit={})})(this,function(e){"use strict";const t=/---!{.*?(}!---)/gi;const s=/^\(.*\)$/gi;const n=/^\[.*\]$/;const i=/t-model/gi;const r=Symbol("t-model");const o=Symbol("RemoveTemplate");const a=Symbol("Renderer");const c=e=>+e.replace(/(---!{)|(}!---)/gi,"");const h=e=>e.replace(/(\()|(\))/gi,"");class l{constructor(e,s){this.node=e;this.compiler=s;this.base=e.nodeValue||"";this.indicies=this.base.match(t).map(c);this.indicies.forEach(e=>this.compiler.partIndicies.set(e,this))}set value(e){const s=this.base.replace(t,e);this.value!==s?this.node.nodeValue=s:null}get value(){return this.node.nodeValue}setValue(e=[]){this.node.nodeValue=this.base.replace(/---!{*.}!---/g,t=>e[c(t)])}update(e){this.node.nodeValue=this.base.replace(/---!{*.}!---/g,t=>{const s=e[c(t)];if(Array.isArray(s)){return s.join("")}else{return s===null?"":s}})}}class d{constructor(e,s,n,i,r){this.node=e;this.boundAttrs=s;this.boundEvents=n;this.context=i;this.compiler=r;this.boundAttrs.forEach(e=>{e.base=e.value;const s=e.base.match(t)||[];this.indicies=s.map(c);this.indicies.forEach(e=>this.compiler.partIndicies.set(e,this))});this.eventMap=new Map;this.addListeners()}addListener(e,t){this.node.addEventListener(e,t.bind(this.context));this.eventMap.set(e,t);!this.context.DEBUG?this.node.removeAttribute(`(${e})`):null}addListeners(){this.boundEvents.forEach((e,t)=>{if(t===r){this.context[e]=this.context[e]?this.context[e]:undefined;this.node.value=this.context[e];this.node.addEventListener("input",this._modelFunction(e));this.node.addEventListener("change",this._modelFunction(e))}else{if(typeof e==="function"){this.addListener(t,e)}else{const s=e.replace(/(this\.)|(\(.*\))/gi,"");if(typeof this.context[s]!=="function"){console.error(`Method ${s} is not a method of element ${this.context.tagName}`)}else{const e=this.context[s].bind(this.context);this.addListener(t,e)}}}})}disconnect(){if(this.eventMap.size){this.eventMap.forEach((e,t,s)=>{this.node.removeEventListener(t,e);s.delete(t)})}}updateProperty(e,t){const s=e.name.replace(/\[|\]/g,"");!this.context.DEBUG?this.node.removeAttribute(e.name):null;this.node[s]=t;if(s==="innerhtml"){this.node.innerHTML=t.join("");this.node.removeAttribute("innerhtml");this.node.removeAttribute("innerHTML")}if(t&&(t!=="false"&&t!=="undefined")){this.node.setAttribute(s,t)}else{this.node[s]=false;this.node.removeAttribute(s)}}update(e){this.boundAttrs.forEach(t=>{const s=t.base.match(/---!{\d+}!---/gi)||[];const i=s.map(c);let r=t.base;for(let s=0;s<i.length;s+=1){const n=i[s];const o=e[n]||"";if(typeof o!=="function"){r=r.replace(`---!{${n}}!---`,o)}else{this.addListener(h(t.name),o)}}t.value=r;if(t.name.match(n)){if(i.length===1){r=e[i[0]]}this.updateProperty(t,r)}})}_modelFunction(e){const{context:t}=this;return function(){t[e]=this.value}}}class u{constructor(e,t,s,n,i){this.node=e;this.values=t;this.context=s;this.compiler=n;this.index=i;this.templateMap=new Map;this.compiler.partIndicies.set(i,this)}init(){this.templates=this.values.map(e=>{const t=e[1].$$key;let s;if(this.templateMap.has(t)){s=this.templateMap.get(t)}else{s=new p(e[0],e[1],this.node.parentNode,this.context);this.templateMap.set(t,s)}return s})}update(e){const t=e[this.index];const s=this.values;this.values=t;const n=new Set(this.values.map(e=>e[1].$$key));const i=new Set(s.map(e=>e[1].$$key));if(n.size<i.size){n.forEach(e=>i.delete(e));i.forEach(e=>{const t=this.templateMap.get(e);t[o]();this.templateMap.delete(e)})}if(t.length!==s.length){this.init()}else{this.templates.forEach((t,s)=>{t.update(e[this.index][s][1])})}}}class p{constructor(e,t,s,n){this.strings=e;this.values=t;this.oldValues=t.map((e,t)=>`---!{${t}}!---`);this.location=s;this.context=n;this.context.refs=this.context.refs||{};this.parts=[];this.partIndicies=new Map;this.context.$el=s;this.templateSymbol=Symbol("Template");this.eventHandlers=[];this.nodes=[];this._init()}_append(e){for(let e=0;e<this.parts.length;e+=1){const t=this.parts[e];if(t instanceof l){t.setValue(this.values,this.oldValues[e])}else if(t instanceof d){t.update(this.values,this.oldValues)}else if(t instanceof u){t.init()}}const t=this.templateSymbol;this.nodes=Array.from(e.children).map(e=>{e[t]=true;return e});this.location.appendChild(e);if(!this.context[a]){Object.defineProperty(this,a,{value:this,enumerable:false,configurable:false,writable:false});this.context.onInit&&typeof this.context.onInit==="function"&&this.context.onInit()}}_init(){const e=this.strings.map((e,t)=>{const s=this.values[t];const n=`---!{${t}}!---`;let i="";i+=e?e:"";if(s!==undefined&&!Array.isArray(s)){i+=n}else if(s!==undefined&&Array.isArray(s)){i+=`\x3c!-- ${n} --\x3e`}return i}).join("");const t=document.createElement("template");t.innerHTML=e;const s=document.importNode(t.content,true);const n=document.createTreeWalker(s,133,null,false);this._walk(n,this.parts,true);this._append(s)}_walk(e,o){while(e.nextNode()){const{currentNode:a}=e;if(!a.__templiteralCompiler){switch(a.nodeType){case 1:{const{attributes:e}=a;if(e.length){const h=new Map;const l=new Map;for(let o=0;o<e.length;o+=1){const d=e[o];if(d.value.match(t)||d.name.match(n)){h.set(d.name,d)}else if(d.name.match(s)){if(!d.value.match(t)){const e=d.name.substring(1,d.name.length-1);l.set(e,d.value);this.eventHandlers.push({eventName:e,currentNode:a})}else if(d.value.match(t)){const e=d.name.substring(1,d.name.length-1);const t=this.values[c(d.value)];l.set(e,t);this.eventHandlers.push({eventName:e,currentNode:a})}}else if(d.name.match(i)){l.set(r,d.value)}else if(d.name.match("ref")){this.context.refs[d.value]=a}}if(h.size>=1||l.size>=1){const e=new d(a,h,l,this.context,this);o.push(e)}}break}case 3:{if(a.textContent&&a.textContent.match(t)){const e=new l(a,this);o.push(e)}break}case 8:{const e=c(a.nodeValue);const t=this.values[e];const s=this.values[e];const n=new u(a,s,this.context,this,e,t);o.push(n);break}}}else{this.templiteralParts.add(a)}}}update(e){this.oldValues=this.values;this.values=e;for(let t=0;t<e.length;t+=1){if(e[t]!==this.oldValues[t]){window.requestAnimationFrame(()=>this.partIndicies.get(t).update(e))}}}[o](){this.nodes.forEach(e=>this.location.removeChild(e));this.parts.filter(e=>e instanceof d).forEach(e=>e.disconnect())}}class f extends HTMLElement{constructor(){super();this.templiteral=v}connectedCallback(){console.warn("t-repeat is being deprecated in favor of inline array methods.");this._render()}_render(){this.templiteral()(this.items.map(this.templatecallback()))}}if(!customElements.get("t-repeat")){customElements.define("t-repeat",f)}class m extends HTMLElement{constructor(){super();this.cached=[]}connectedCallback(){this.style.display="contents"}set condition(e){if(e===false){Array.from(this.children).map(e=>{this.cached.push(e);this.removeChild(e)});this.innerHTML=""}else if(e===true){this.cached.forEach(e=>this.appendChild(e));this.cached=[]}}}if(!customElements.get("t-if")){customElements.define("t-if",m)}const b=new WeakMap;function v(e=this,t=this){e.shadowRoot?e=e.shadowRoot:null;return(s,...n)=>{let i=b.get(e);if(i&&s===i.strings){i.update(n)}else if(i){[...i.location.children].forEach(e=>i.location.removeChild(e));i=new p(s,n,e,t);b.set(e,i)}else{i=new p(s,n,e,t);b.set(e,i)}return i}}function g(e){return(t,...s)=>{Object.defineProperty(s,"$$key",{value:e,enumerable:false,configurable:false,writable:false});return[t,s]}}class y extends HTMLElement{static get boundAttributes(){return[]}static get boundProps(){return[]}static get observedAttributes(){return[...this.boundAttributes]}static get renderer(){return"render"}constructor(){super();const e=this;const t=new Set;this.constructor.boundAttributes.map((e,s,n)=>{Object.defineProperty(this,e,{get(){return this.getAttribute(e)||this.hasAttribute(e)},set(s){if(s||e===""){this.setAttribute(e,s)}else{this.removeAttribute(e)}if(this.constructor.renderer&&typeof this[this.constructor.renderer]==="function"&&this.isConnected&&t.size===n.length){this[this.constructor.renderer]()}t.add(e)}})});Object.defineProperty(this,"templiteral",{get(){const t=e.shadowRoot?e.shadowRoot:e;return v(t,e)},configurable:false,enumerable:false});Object.defineProperty(this,"html",{get(){return(...t)=>{return new Promise(s=>window.requestAnimationFrame(()=>s(Reflect.apply(e.templiteral,e,t))))}},configurable:false,enumerable:false});Object.defineProperty(this,"fragment",{value:g,configurable:false,enumerable:false,writable:false})}attributeChangedCallback(e,t,s){if(t!==s){this[e]=s}else if(s===""&&this.hasAttribute(e)){this[e]=true}}connectedCallback(){if(this.constructor.renderer&&typeof this[this.constructor.renderer]==="function"){this[this.constructor.renderer]();this.addEventListener("ComponentRender",()=>{setTimeout(this[this.constructor.renderer].bind(this),0)})}if(this[this.constructor.renderer]&&this.constructor.boundProps.length){this.constructor.boundProps.map(e=>{this[e]=x(this[e],()=>{const e=new CustomEvent("ComponentRender",{bubbles:true,composed:true,detail:{component:this,time:Date.now()}});this.dispatchEvent(e);return this[this.constructor.renderer].bind(this)})})}}disconnectedCallback(){b.delete(this);if(this.constructor.renderer&&typeof this[this.constructor.renderer]==="function"){this.removeEventListener("ComponentRender",this[this.constructor.renderer])}this[a][o]()}emit(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))}}const x=(e,t)=>{const s={get(e,t,n){const i=Object.getOwnPropertyDescriptor(e,t);const r=Reflect.get(e,t,n);if(i&&!i.writable&&!i.configurable&&t!=="push"){return r}try{return new Proxy(e[t],s)}catch(s){return Reflect.get(e,t,n)}},defineProperty(e,s,n){t();return Reflect.defineProperty(e,s,n)},deleteProperty(e,s){t();return Reflect.deleteProperty(e,s)}};return new Proxy(e,s)};e.templiteral=v;e.fragment=g;e.Component=y;e.watch=x;Object.defineProperty(e,"__esModule",{value:true})});