(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports):typeof define==="function"&&define.amd?define(["exports"],t):t(e.templit={})})(this,function(e){"use strict";const t=/---!{.*?(}!---)/gi;const s=/^\(.*\)$/gi;const n=/^\[.*\]$/;const i=/---!\{/gi;const r=/\}!---/gi;const o=/t-model/gi;const a=Symbol("t-model");class c{constructor(e,s){this.node=e;this.compiler=s;this.base=e.nodeValue||"";this.indicies=this.base.match(t).map(e=>+e.replace(i,"").replace(r,""));this.indicies.forEach(e=>this.compiler.partIndicies.set(e,this))}set value(e){const s=this.base.replace(t,e);this.value!==s?this.node.nodeValue=s:null}get value(){return this.node.nodeValue}setValue(e=[]){this.node.nodeValue=this.base.replace(/---!{*.}!---/g,t=>e[+t.replace(i,"").replace(r,"")])}update(e){this.node.nodeValue=this.base.replace(/---!{*.}!---/g,t=>{const s=e[+t.replace(i,"").replace(r,"")];if(Array.isArray(s)){return s.join("")}else{return s===null?"":s}})}}class l{constructor(e,s,n,o,a){this.node=e;this.boundAttrs=s;this.boundEvents=n;this.context=o;this.compiler=a;this.boundAttrs.forEach(e=>{e.base=e.value;const s=e.base.match(t)||[];this.indicies=s.map(e=>+e.replace(i,"").replace(r,""));this.indicies.forEach(e=>this.compiler.partIndicies.set(e,this))});this.addListeners()}addListeners(){this.boundEvents.forEach((e,t)=>{if(t===a){this.context[e]=this.context[e]?this.context[e]:undefined;this.node.value=this.context[e];this.node.addEventListener("input",this._modelFunction(e));this.node.addEventListener("change",this._modelFunction(e))}else{const s=e.replace(/(this\.)|(\(.*\))/gi,"");if(typeof this.context[s]!=="function"){console.error(`Method ${s} is not a method of element ${this.context.tagName}`)}else{const e=this.context[s].bind(this.context);this.node.addEventListener(t,e);this.node._boundEvents=e}}})}updateProperty(e,t){const s=e.name.replace(/\[|\]/g,"");this.node[s]=t;if(s==="innerhtml"){this.node.innerHTML=t.join("");this.node.removeAttribute("innerhtml");this.node.removeAttribute("innerHTML")}if(t&&(t!=="false"&&t!=="undefined")){this.node.setAttribute(s,t)}else{this.node[s]=false;this.node.removeAttribute(s)}}update(e){this.boundAttrs.forEach(t=>{const s=t.base.match(/---!{*.}!---/g)||[];const i=s.map(e=>+e.replace("---!{","").replace("}!---",""));let r=t.base;if(i.length===1){r=r.replace(`---!{${i[0]}}!---`,e[i[0]])}else if(i.length>1){for(let t=0;t<i.length;t+=1){const s=e[i[t]]||"";r=r.replace(`---!{${i[t]}}!---`,s)}}t.value=r;if(t.name.match(n)){if(i.length===1){r=e[i[0]]}this.updateProperty(t,r)}})}_modelFunction(e){const{context:t}=this;return function(){t[e]=this.value}}}class h{constructor(e,t,s,n){this.strings=e;this.values=t;this.oldValues=t.map((e,t)=>`---!{${t}}!---`);this.location=s;this.context=n;this.parts=[];this.partIndicies=new Map;this.context.$el=s;this.eventHandlers=[];this._init()}_append(e){for(let e=0;e<this.parts.length;e+=1){const t=this.parts[e];if(t instanceof c){t.setValue(this.values,this.oldValues[e])}else if(t instanceof l){t.update(this.values,this.oldValues)}}this.location.appendChild(e)}_init(){const e=this.strings.map((e,t)=>`${e?e:""}${this.values[t]!==undefined?"---!{"+t+"}!---":""}`).join("");const t=this.strings.map((e,t)=>{const s=this.values[t];const n=`---!{${t}}!---`;let i="";i+=e?e:"";if(s!==undefined&&!Array.isArray(s)){i+=n}else if(s!==undefined&&Array.isArray(s)){i+=`<div style="display: contents" [innerHTML]="${n}"></div>`}return i}).join("");const s=document.createElement("template");s.innerHTML=t;const n=document.importNode(s.content,true);const i=document.createTreeWalker(n,133,null,false);this._walk(i,this.parts,true);this._append(n)}_walk(e,i){this.context.refs=this.context.refs||{};while(e.nextNode()){const{currentNode:r}=e;if(!r.__templiteralCompiler){switch(r.nodeType){case 1:{const{attributes:e}=r;if(e.length){const c=new Map;const h=new Map;for(let i=0;i<e.length;i+=1){const l=e[i];if(l.value.match(t)||l.name.match(n)){c.set(l.name,l)}else if(l.name.match(s)){const e=l.name.substring(1,l.name.length-1);h.set(e,l.value);this.eventHandlers.push({eventName:e,currentNode:r})}else if(l.name.match(o)){h.set(a,l.value)}else if(l.name.match("ref")){this.context.refs[l.value]=r}}if(c.size>=1||h.size>=1){const e=new l(r,c,h,this.context,this);i.push(e)}}break}case 3:{if(r.textContent&&r.textContent.match(t)){const e=new c(r,this);i.push(e)}break}}}else{this.templiteralParts.add(r)}}}update(e){this.oldValues=this.values;this.values=e;for(let t=0;t<e.length;t+=1){if(e[t]!==this.oldValues[t]){window.requestAnimationFrame(()=>this.partIndicies.get(t).update(e))}}}}class d extends HTMLElement{constructor(){super();this.templiteral=f}connectedCallback(){this._render()}_render(){this.templiteral()(this.items.map(this.templatecallback()))}}if(!customElements.get("t-repeat")){customElements.define("t-repeat",d)}class u extends HTMLElement{constructor(){super();this.cached=[]}connectedCallback(){this.style.display="contents"}set condition(e){if(e===false){Array.from(this.children).map(e=>{this.cached.push(e);this.removeChild(e)});this.innerHTML=""}else if(e===true){this.cached.forEach(e=>this.appendChild(e));this.cached=[]}}}if(!customElements.get("t-if")){customElements.define("t-if",u)}const p=new WeakMap;function f(e=this,t=this){e.shadowRoot?e=e.shadowRoot:null;return(s,...n)=>{let i=p.get(e);if(i){i.update(n)}else{i=new h(s,n,e,t);p.set(e,i)}return i}}class m extends HTMLElement{static get boundAttributes(){return[]}static get observedAttributes(){return[...this.boundAttributes]}constructor(){super();const e=this;const t=new Set;this.constructor.boundAttributes.map((e,s,n)=>{Object.defineProperty(this,e,{get(){return this.getAttribute(e)},set(s){if(s){this.setAttribute(e,s)}else{this.removeAttribute(e)}if(this.constructor.renderer&&typeof this[this.constructor.renderer]==="function"&&this.isConnected&&t.size===n.length){this[this.constructor.renderer]()}t.add(e)}})});Object.defineProperty(this,"templiteral",{get(){const t=e.shadowRoot?e.shadowRoot:e;return f(t,e)},enumerable:false,configurable:false});Object.defineProperty(this,"html",{enumerable:false,get(){return(...t)=>{window.requestAnimationFrame(()=>Reflect.apply(e.templiteral,e,t))}}})}attributeChangedCallback(e,t,s){if(t!==s){this[e]=s}}connectedCallback(){if(this.constructor.renderer&&typeof this[this.constructor.renderer]==="function"){this[this.constructor.renderer]()}}disconnectedCallback(){p.delete(this)}}const b=(e,t)=>{const s={get(e,t,n){try{return new Proxy(e[t],s)}catch(s){return Reflect.get(e,t,n)}},defineProperty(e,s,n){t();return Reflect.defineProperty(e,s,n)},deleteProperty(e,s){t();return Reflect.deleteProperty(e,s)}};return new Proxy(e,s)};e.templiteral=f;e.Component=m;e.watch=b;Object.defineProperty(e,"__esModule",{value:true})});