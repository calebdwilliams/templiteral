(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports):typeof define==="function"&&define.amd?define(["exports"],e):e(t.templit={})})(this,function(t){"use strict";const e=/---!{.*?(}!---)/gi;const s=/^\(.*\)$/gi;const n=/^\[.*\]$/;const i=/t-model/gi;const r=/---!{\d+}!---/gi;const o=Symbol("t-model");const a=Symbol("RemoveTemplate");const c=Symbol("Renderer");const h=t=>+t.replace(/(---!{)|(}!---)/gi,"");const l=t=>t.replace(/(\()|(\))/gi,"");class d{constructor(t,s){this.node=t;this.compiler=s;this.base=t.nodeValue||"";this.indicies=this.base.match(e).map(h);this.indicies.forEach(t=>this.compiler.partIndicies.set(t,this))}update(t){this.node.nodeValue=this.base.replace(r,e=>t[h(e)]===null?"":t[h(e)])}}class u{constructor(t,s,n,i,r){this.node=t;this.boundAttrs=s;this.boundEvents=n;this.context=i;this.compiler=r;this.boundAttrs.forEach(t=>{t.base=t.value;const s=t.base.match(e)||[];this.indicies=s.map(h);this.indicies.forEach(t=>this.compiler.partIndicies.set(t,this))});this.eventMap=new Map;this.addListeners()}addListener(t,e){this.node.addEventListener(t,e.bind(this.context));this.eventMap.set(t,e);!this.context.DEBUG?this.node.removeAttribute(`(${t})`):null}addListeners(){this.boundEvents.forEach((t,e)=>{if(e===o){this.context[t]=this.context[t]?this.context[t]:undefined;this.node.value=this.context[t];this.node.addEventListener("input",this._modelFunction(t));this.node.addEventListener("change",this._modelFunction(t))}else{if(typeof t==="function"){this.addListener(e,t)}else{const s=t.replace(/(this\.)|(\(.*\))/gi,"");if(typeof this.context[s]!=="function"){console.error(`Method ${s} is not a method of element ${this.context.tagName}`)}else{const t=this.context[s].bind(this.context);this.addListener(e,t)}}}})}disconnect(){if(this.eventMap.size){this.eventMap.forEach((t,e,s)=>{this.node.removeEventListener(e,t);s.delete(e)})}}updateProperty(t,e){const s=t.name.replace(/\[|\]/g,"");!this.context.DEBUG?this.node.removeAttribute(t.name):null;this.node[s]=e;if(s==="innerhtml"){this.node.innerHTML=e.join("");this.node.removeAttribute("innerhtml");this.node.removeAttribute("innerHTML")}if(e&&(e!=="false"&&e!=="undefined")){this.node.setAttribute(s,e)}else{this.node[s]=false;this.node.removeAttribute(s)}}update(t){this.boundAttrs.forEach(e=>{const s=e.base.match(r)||[];const i=s.map(h);let o=e.base;for(let s=0;s<i.length;s+=1){const n=i[s];const r=t[n]||"";if(typeof r!=="function"){o=o.replace(`---!{${n}}!---`,r)}else{this.addListener(l(e.name),r)}}e.value=o;if(e.name.match(n)){if(i.length===1){o=t[i[0]]}this.updateProperty(e,o)}})}_modelFunction(t){const{context:e}=this;return function(){e[t]=this.value}}}class p{constructor(t,e,s,n,i){this.node=t;this.values=e;this.context=s;this.compiler=n;this.index=i;this.templateMap=new Map;this.compiler.partIndicies.set(i,this)}init(){this.templates=this.values.map(t=>{const e=t[1].$$key;let s;if(this.templateMap.has(e)){s=this.templateMap.get(e)}else{s=new f(t[0],t[1],this.node.parentNode,this.context);this.templateMap.set(e,s)}return s})}update(t){const e=t[this.index];const s=this.values;this.values=e;const n=new Set(this.values.map(t=>t[1].$$key));const i=new Set(s.map(t=>t[1].$$key));if(n.size<i.size){n.forEach(t=>i.delete(t));i.forEach(t=>{const e=this.templateMap.get(t);e[a]();this.templateMap.delete(t)})}if(e.length!==s.length){this.init()}else{this.templates.forEach((e,s)=>{e.update(t[this.index][s][1])})}}}class f{constructor(t,e,s,n){this.strings=t;this.values=e;this.oldValues=e.map((t,e)=>`---!{${e}}!---`);this.location=s;this.context=n;this.context.refs=this.context.refs||{};this.parts=[];this.partIndicies=new Map;this.context.$el=s;this.templateSymbol=Symbol("Template");this.eventHandlers=[];this.nodes=[];this._init()}_append(t){for(let t=0;t<this.parts.length;t+=1){const e=this.parts[t];if(e instanceof u||e instanceof d){e.update(this.values,this.oldValues)}else if(e instanceof p){e.init()}}const e=this.templateSymbol;this.nodes=Array.from(t.children).map(t=>{t[e]=true;return t});this.location.appendChild(t);if(!this.context[c]){Object.defineProperty(this,c,{value:this,enumerable:false,configurable:false,writable:false});this.context.onInit&&typeof this.context.onInit==="function"&&this.context.onInit()}}_init(){const t=this.strings.map((t,e)=>{const s=this.values[e];const n=`---!{${e}}!---`;let i="";i+=t?t:"";if(s!==undefined&&!Array.isArray(s)){i+=n}else if(s!==undefined&&Array.isArray(s)){i+=`\x3c!-- ${n} --\x3e`}return i}).join("");const e=document.createElement("template");e.innerHTML=t;const s=document.importNode(e.content,true);const n=document.createTreeWalker(s,133,null,false);this._walk(n,this.parts,true);this._append(s)}_walk(t,r){while(t.nextNode()){const{currentNode:a}=t;if(!a.__templiteralCompiler){switch(a.nodeType){case 1:{const{attributes:t}=a;if(t.length){const c=new Map;const l=new Map;for(let r=0;r<t.length;r+=1){const d=t[r];if(d.value.match(e)||d.name.match(n)){c.set(d.name,d)}else if(d.name.match(s)){if(!d.value.match(e)){const t=d.name.substring(1,d.name.length-1);l.set(t,d.value);this.eventHandlers.push({eventName:t,currentNode:a})}else if(d.value.match(e)){const t=d.name.substring(1,d.name.length-1);const e=this.values[h(d.value)];l.set(t,e);this.eventHandlers.push({eventName:t,currentNode:a})}}else if(d.name.match(i)){l.set(o,d.value)}else if(d.name.match("ref")){this.context.refs[d.value]=a}}if(c.size>=1||l.size>=1){const t=new u(a,c,l,this.context,this);r.push(t)}}break}case 3:{if(a.textContent&&a.textContent.match(e)){const t=new d(a,this);r.push(t)}break}case 8:{const t=h(a.nodeValue);const e=this.values[t];const s=this.values[t];const n=new p(a,s,this.context,this,t,e);r.push(n);break}}}else{this.templiteralParts.add(a)}}}update(t){this.oldValues=this.values;this.values=t;for(let e=0;e<t.length;e+=1){if(t[e]!==this.oldValues[e]){window.requestAnimationFrame(()=>this.partIndicies.get(e).update(t))}}}[a](){this.nodes.forEach(t=>this.location.removeChild(t));this.parts.filter(t=>t instanceof u).forEach(t=>t.disconnect())}}class m extends HTMLElement{constructor(){super();this.templiteral=g}connectedCallback(){console.warn("t-repeat is being deprecated in favor of inline array methods.");this._render()}_render(){this.templiteral()(this.items.map(this.templatecallback()))}}if(!customElements.get("t-repeat")){customElements.define("t-repeat",m)}class b extends HTMLElement{constructor(){super();this.cached=[]}connectedCallback(){this.style.display="contents"}set condition(t){if(t===false){Array.from(this.children).map(t=>{this.cached.push(t);this.removeChild(t)});this.innerHTML=""}else if(t===true){this.cached.forEach(t=>this.appendChild(t));this.cached=[]}}}if(!customElements.get("t-if")){customElements.define("t-if",b)}const v=new WeakMap;function g(t=this,e=this){t.shadowRoot?t=t.shadowRoot:null;return(s,...n)=>{let i=v.get(t);if(i&&s===i.strings){i.update(n)}else if(i){[...i.location.children].forEach(t=>i.location.removeChild(t));i=new f(s,n,t,e);v.set(t,i)}else{i=new f(s,n,t,e);v.set(t,i)}return i}}function y(t){return(e,...s)=>{Object.defineProperty(s,"$$key",{value:t,enumerable:false,configurable:false,writable:false});return[e,s]}}class x extends HTMLElement{static get boundAttributes(){return[]}static get boundProps(){return[]}static get observedAttributes(){return[...this.boundAttributes]}static get renderer(){return"render"}constructor(){super();const t=this;const e=new Set;this.constructor.boundAttributes.map((t,s,n)=>{Object.defineProperty(this,t,{get(){return this.getAttribute(t)||this.hasAttribute(t)},set(s){if(s||s===""){this.setAttribute(t,s)}else{this.removeAttribute(t)}if(this.constructor.renderer&&typeof this[this.constructor.renderer]==="function"&&this.isConnected&&e.size===n.length){this[this.constructor.renderer]()}e.add(t)}})});Object.defineProperty(this,"templiteral",{get(){const e=t.shadowRoot?t.shadowRoot:t;return g(e,t)},configurable:false,enumerable:false});Object.defineProperty(this,"html",{get(){return(...e)=>{return new Promise(s=>window.requestAnimationFrame(()=>s(Reflect.apply(t.templiteral,t,e))))}},configurable:false,enumerable:false});Object.defineProperty(this,"fragment",{value:y,configurable:false,enumerable:false,writable:false})}attributeChangedCallback(t,e,s){if(e!==s){this[t]=s}else if(s===""&&this.hasAttribute(t)){this[t]=true}}connectedCallback(){if(this.constructor.renderer&&typeof this[this.constructor.renderer]==="function"){this[this.constructor.renderer]();this.addEventListener("ComponentRender",()=>{setTimeout(this[this.constructor.renderer].bind(this),0)})}if(this[this.constructor.renderer]&&this.constructor.boundProps.length){this.constructor.boundProps.map(t=>{this[t]=w(this[t],()=>{const t=new CustomEvent("ComponentRender",{bubbles:true,composed:true,detail:{component:this,time:Date.now()}});this.dispatchEvent(t);return this[this.constructor.renderer].bind(this)})})}}disconnectedCallback(){v.delete(this);if(this.constructor.renderer&&typeof this[this.constructor.renderer]==="function"){this.removeEventListener("ComponentRender",this[this.constructor.renderer])}this[c]&&this[c][a]()}emit(t,e){this.dispatchEvent(new CustomEvent(t,{detail:e}))}}const w=(t,e)=>{const s={get(t,e,n){const i=Object.getOwnPropertyDescriptor(t,e);const r=Reflect.get(t,e,n);if(i&&!i.writable&&!i.configurable&&e!=="push"){return r}try{return new Proxy(t[e],s)}catch(s){return Reflect.get(t,e,n)}},defineProperty(t,s,n){e();return Reflect.defineProperty(t,s,n)},deleteProperty(t,s){e();return Reflect.deleteProperty(t,s)}};return new Proxy(t,s)};t.templiteral=g;t.fragment=y;t.Component=x;t.watch=w;Object.defineProperty(t,"__esModule",{value:true})});